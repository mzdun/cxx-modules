CXXFLAGS = -std=c++20 -O0 -g

rule cc
    command = /usr/bin/x86_64-linux-gnu-g++-11 $DEFINES $CFLAGS $CXXFLAGS -fmodules-ts -c $in -o $out
    description = Building CXX object $out

rule ar
    command = rm  -rf $out && /usr/bin/x86_64-linux-gnu-gcc-ar-11 qc $out $LINK_FLAGS $in && /usr/bin/x86_64-linux-gnu-gcc-ranlib-11 $out
    description = Linking CXX static library $out

rule link-exe
    command = /usr/bin/x86_64-linux-gnu-g++-11 $in -o $out
    description = Linking CXX executable $out

build app/example.dir/main.cc.o: cc ../app/main.cc || gcm.cache/name.gcm
build app/example: link-exe app/example.dir/main.cc.o lib/libgreeter.a
build lib/greeter.dir/mod-iface.cc.o | gcm.cache/name.gcm: cc ../lib/mod-iface.cc
build lib/greeter.dir/mod-impl.cc.o: cc ../lib/mod-impl.cc || gcm.cache/name.gcm
build lib/libgreeter.a: ar lib/greeter.dir/mod-iface.cc.o lib/greeter.dir/mod-impl.cc.o
